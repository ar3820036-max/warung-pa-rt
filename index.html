<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Warung Pak RT</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
body{background:#f2f4f7;width:100%;overflow-x:hidden;}
header{background:linear-gradient(135deg,#ff5722,#ff8a00);color:white;text-align:center;padding:25px;font-size:26px;font-weight:bold;}
.container{width:100%;padding:15px;}
form{background:#fff;border-radius:15px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.08);margin-bottom:20px;}
form input{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:1px solid #ddd;}
form button{width:100%;margin-top:15px;padding:14px;background:linear-gradient(135deg,#ff6a00,#ff9100);color:white;border:none;border-radius:8px;font-size:16px;}
.order-summary{margin-top:15px;}
.order-summary li{display:flex;justify-content:space-between;padding:5px 0;}
.total{font-weight:bold;margin-top:10px;text-align:right;}
.search-box{width:100%;margin-bottom:15px;}
.search-box input{width:100%;padding:12px;border-radius:10px;border:1px solid #ccc;}

.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
@media(min-width:768px){
  .products{grid-template-columns:repeat(3,1fr);}
}
.product-card{
  background:white;
  border-radius:15px;
  padding:12px;
  text-align:center;
  box-shadow:0 5px 15px rgba(0,0,0,.08);
}
.product-card img{width:100%;height:150px;object-fit:cover;border-radius:10px;}
.qty-box{display:flex;justify-content:center;gap:10px;margin-top:6px;}
.qty-box button{width:36px;height:36px;border:none;background:#ff7a00;color:white;border-radius:50%;font-size:18px;}
.qty-value{font-weight:bold;}
</style>
</head>

<body>

<header>Warung Pak RT</header>

<div class="container">

<form id="orderForm">
  <input type="text" id="name" placeholder="Nama Anda" required>
  <input type="text" id="address" placeholder="Alamat Lengkap" required>

  <div class="order-summary">
    <h4>Ringkasan Pesanan</h4>
    <ul id="summaryList"></ul>
    <div class="total">Total: Rp <span id="totalPrice">0</span></div>
  </div>

  <button type="submit">Kirim Pesanan</button>
</form>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Cari produk...">
</div>

<div class="products" id="productsContainer"></div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAfKkS6BdYNCxRwGh2hP2uCY7dCeLpSpV4",
  authDomain: "warung-e2545.firebaseapp.com",
  databaseURL: "https://warung-e2545-default-rtdb.firebaseio.com",
  projectId: "warung-e2545"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const products=[
 {id:"p1",name:"Mie Goreng",price:12000,image:"https://i.imgur.com/5OZp4Jr.jpg",qty:0},
 {id:"p2",name:"Minyak Goreng",price:25000,image:"https://i.imgur.com/Y3xE4Kk.jpg",qty:0},
 {id:"p3",name:"Kopi",price:15000,image:"https://i.imgur.com/d3h3T0r.jpg",qty:0},
 {id:"p4",name:"Teh",price:10000,image:"https://i.imgur.com/LMYzqS3.jpg",qty:0}
];

const productsContainer=document.getElementById("productsContainer");
const summaryList=document.getElementById("summaryList");
const totalPriceEl=document.getElementById("totalPrice");

function renderProducts(list){
  productsContainer.innerHTML="";
  list.forEach(p=>{
    const card=document.createElement("div");
    card.className="product-card";
    card.innerHTML=`
      <img src="${p.image}">
      <h4>${p.name}</h4>
      <p>Rp ${p.price}</p>
      <div class="qty-box">
        <button onclick="changeQty('${p.id}',-1)">âˆ’</button>
        <span class="qty-value">${p.qty}</span>
        <button onclick="changeQty('${p.id}',1)">+</button>
      </div>`;
    productsContainer.appendChild(card);
  });
}

function changeQty(id,val){
  const p=products.find(x=>x.id===id);
  p.qty=Math.max(0,p.qty+val);
  updateSummary();
  renderProducts(products);
}

function updateSummary(){
  summaryList.innerHTML="";
  let total=0;
  products.forEach(p=>{
    if(p.qty>0){
      const li=document.createElement("li");
      li.textContent=`${p.name} x${p.qty} = Rp ${p.qty*p.price}`;
      summaryList.appendChild(li);
      total+=p.qty*p.price;
    }
  });
  totalPriceEl.textContent=total;
}

document.getElementById("searchInput").addEventListener("input",e=>{
  const q=e.target.value.toLowerCase();
  renderProducts(products.filter(p=>p.name.toLowerCase().includes(q)));
});

document.getElementById("orderForm").addEventListener("submit",e=>{
  e.preventDefault();

  const nama=document.getElementById("name").value.trim();
  const alamat=document.getElementById("address").value.trim();
  const barang=products.filter(p=>p.qty>0);

  if(!barang.length) return alert("Pilih produk dulu!");

  const waktu = new Date().toLocaleString("id-ID").replace(/[^\w]/g,"_");
  const key = nama.replace(/\s+/g,"_") + "_" + waktu;

  db.ref("pesanan/" + key).set({
    nama,
    alamat,
    barang: barang.map(b => `${b.name} x${b.qty}`),
    total: barang.reduce((a,b)=>a+b.price*b.qty,0)
  }).then(()=>{
    alert("Pesanan berhasil dikirim!");
    location.reload();
  });
});

renderProducts(products);
</script>

</body>
</html>

